<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- AI Module Category -->
    <record id="module_category_ai" model="ir.module.category">
        <field name="name">AI Chatbot</field>
        <field name="description">AI Chatbot and Agent Management</field>
        <field name="sequence">100</field>
    </record>

    <!-- User Group -->
    <record id="group_ai_user" model="res.groups">
        <field name="name">AI User</field>
        <field name="category_id" ref="module_category_ai"/>
        <field name="comment">Can view AI conversations and use playground</field>
    </record>

    <!-- Manager Group -->
    <record id="group_ai_manager" model="res.groups">
        <field name="name">AI Manager</field>
        <field name="category_id" ref="module_category_ai"/>
        <field name="implied_ids" eval="[(4, ref('group_ai_user'))]"/>
        <field name="comment">Can configure AI agents, rules, and tools</field>
    </record>

    <!-- Admin Group -->
    <record id="group_ai_admin" model="res.groups">
        <field name="name">AI Administrator</field>
        <field name="category_id" ref="module_category_ai"/>
        <field name="implied_ids" eval="[(4, ref('group_ai_manager'))]"/>
        <field name="comment">Full access including API keys and provider configuration</field>
    </record>

    <!-- Record Rules -->

    <!-- Users can only see conversations of agents they have access to -->
    <record id="ai_conversation_user_rule" model="ir.rule">
        <field name="name">AI Conversation: User Access</field>
        <field name="model_id" ref="model_ai_conversation"/>
        <field name="domain_force">[('agent_id.active', '=', True)]</field>
        <field name="groups" eval="[(4, ref('group_ai_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Managers can manage agents -->
    <record id="ai_agent_manager_rule" model="ir.rule">
        <field name="name">AI Agent: Manager Access</field>
        <field name="model_id" ref="model_ai_agent"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_ai_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Admins have full access -->
    <record id="ai_agent_admin_rule" model="ir.rule">
        <field name="name">AI Agent: Admin Full Access</field>
        <field name="model_id" ref="model_ai_agent"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_ai_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>
</odoo>
