<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Settings Form View - inherits res.config.settings -->
    <record id="res_config_settings_view_form_billing_portal" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.billing.portal</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="50"/>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="inside">
                <app data-string="Portal de Facturación" string="Portal de Facturación" name="billing_portal" groups="billing_portal.group_billing_portal_manager">
                    <block title="Inteligencia Artificial" name="ai_settings">
                        <setting string="API de Google Gemini" help="Configura la conexión con Google Gemini para extracción de datos de CSF">
                            <div class="content-group">
                                <div class="row mt16">
                                    <label for="billing_portal_gemini_api_key" class="col-3 o_light_label"/>
                                    <field name="billing_portal_gemini_api_key" password="True"/>
                                </div>
                                <div class="row">
                                    <label for="billing_portal_gemini_model" class="col-3 o_light_label"/>
                                    <field name="billing_portal_gemini_model"/>
                                </div>
                                <div class="mt8">
                                    <button name="action_test_gemini_connection" type="object"
                                            string="Probar Conexión" class="btn-secondary" icon="fa-plug"/>
                                </div>
                            </div>
                        </setting>
                        <setting string="Validación con IA" help="Configuración del uso de IA para extraer datos del CSF">
                            <field name="billing_portal_use_ai_fallback"/>
                            <div class="content-group" attrs="{'invisible': [('billing_portal_use_ai_fallback', '=', False)]}">
                                <div class="text-muted mt8">
                                    Si la extracción local falla, se usará IA como respaldo
                                </div>
                            </div>
                        </setting>
                        <setting string="Solo usar IA" help="Siempre usar IA para extraer datos (más costoso pero más preciso)">
                            <field name="billing_portal_ai_only"/>
                        </setting>
                    </block>
                    <block title="Configuración del Portal" name="portal_settings">
                        <setting string="Método de Autenticación" help="Cómo se autentican los clientes en el portal">
                            <field name="billing_portal_auth_method" widget="radio"/>
                        </setting>
                        <setting string="Requerir Entrega" help="Solo permitir facturar órdenes con envío entregado">
                            <field name="billing_portal_require_delivery"/>
                        </setting>
                        <setting string="Múltiples Órdenes" help="Permitir facturar múltiples órdenes en una sola solicitud">
                            <field name="billing_portal_allow_multiple_orders"/>
                            <div class="content-group" attrs="{'invisible': [('billing_portal_allow_multiple_orders', '=', False)]}">
                                <div class="row mt8">
                                    <label for="billing_portal_max_orders_per_invoice" class="col-4 o_light_label"/>
                                    <field name="billing_portal_max_orders_per_invoice"/>
                                </div>
                            </div>
                        </setting>
                        <setting string="Duración de Sesión" help="Tiempo que dura la sesión del cliente en horas">
                            <div class="content-group">
                                <div class="row">
                                    <label for="billing_portal_session_duration" class="col-4 o_light_label"/>
                                    <field name="billing_portal_session_duration"/>
                                    <span class="text-muted ml8">horas</span>
                                </div>
                            </div>
                        </setting>
                    </block>
                    <block title="Notificaciones" name="notification_settings">
                        <setting string="Notificar al Recibir Solicitud" help="Enviar notificación cuando se recibe una nueva solicitud">
                            <field name="billing_portal_notify_on_request"/>
                            <div class="content-group" attrs="{'invisible': [('billing_portal_notify_on_request', '=', False)]}">
                                <div class="row mt8">
                                    <label for="billing_portal_notify_emails" class="col-4 o_light_label"/>
                                    <field name="billing_portal_notify_emails" placeholder="email1@ejemplo.com, email2@ejemplo.com"/>
                                </div>
                            </div>
                        </setting>
                    </block>
                    <block title="Base de Datos Externa (MercadoLibre)" name="external_db_settings">
                        <setting string="Conexión PostgreSQL" help="Configuración de la base de datos externa para consultar órdenes">
                            <div class="content-group">
                                <div class="row mt8">
                                    <label for="billing_portal_external_db_host" class="col-3 o_light_label"/>
                                    <field name="billing_portal_external_db_host" placeholder="localhost"/>
                                </div>
                                <div class="row">
                                    <label for="billing_portal_external_db_port" class="col-3 o_light_label"/>
                                    <field name="billing_portal_external_db_port" placeholder="5432"/>
                                </div>
                                <div class="row">
                                    <label for="billing_portal_external_db_name" class="col-3 o_light_label"/>
                                    <field name="billing_portal_external_db_name" placeholder="mercadoLibre"/>
                                </div>
                                <div class="row">
                                    <label for="billing_portal_external_db_user" class="col-3 o_light_label"/>
                                    <field name="billing_portal_external_db_user" placeholder="postgres"/>
                                </div>
                                <div class="row">
                                    <label for="billing_portal_external_db_password" class="col-3 o_light_label"/>
                                    <field name="billing_portal_external_db_password" password="True"/>
                                </div>
                                <div class="mt8">
                                    <button name="action_test_external_db" type="object"
                                            string="Probar Conexión" class="btn-secondary" icon="fa-database"/>
                                </div>
                            </div>
                        </setting>
                    </block>
                </app>
            </xpath>
        </field>
    </record>

    <!-- Billing Status Config Views -->
    <record id="view_billing_status_config_tree" model="ir.ui.view">
        <field name="name">billing.status.config.tree</field>
        <field name="model">billing.status.config</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="code"/>
                <field name="progress_min"/>
                <field name="progress_max"/>
                <field name="is_error"/>
                <field name="is_final"/>
                <field name="active"/>
            </tree>
        </field>
    </record>

    <record id="view_billing_status_config_form" model="ir.ui.view">
        <field name="name">billing.status.config.form</field>
        <field name="model">billing.status.config</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="code"/>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="progress_min"/>
                            <field name="progress_max"/>
                            <field name="color" widget="color"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="icon"/>
                            <field name="message_template"/>
                        </group>
                        <group>
                            <field name="is_error"/>
                            <field name="is_final"/>
                            <field name="active"/>
                        </group>
                    </group>
                    <group>
                        <field name="description"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_billing_status_config" model="ir.actions.act_window">
        <field name="name">Estados de Facturación</field>
        <field name="res_model">billing.status.config</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
