<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Message Compose Wizard Form -->
    <record id="mercadolibre_message_compose_view_form" model="ir.ui.view">
        <field name="name">mercadolibre.message.compose.form</field>
        <field name="model">mercadolibre.message.compose</field>
        <field name="arch" type="xml">
            <form string="Enviar Mensaje MercadoLibre">
                <group attrs="{'invisible': [('can_send', '=', True)]}">
                    <div class="alert alert-warning" role="alert">
                        <field name="cap_warning" readonly="1"/>
                    </div>
                </group>

                <group>
                    <group string="Destinatario">
                        <field name="buyer_nickname" readonly="1"/>
                        <field name="conversation_id" readonly="1"/>
                        <field name="ml_pack_id" readonly="1" invisible="1"/>
                        <field name="account_id" readonly="1" invisible="1"/>
                        <field name="ml_order_id" invisible="1"/>
                        <field name="sale_order_id" invisible="1"/>
                    </group>
                    <group string="Plantilla">
                        <field name="template_id" domain="[('id', 'in', available_template_ids)]"
                               options="{'no_create_edit': True}"/>
                        <field name="available_template_ids" invisible="1"/>
                    </group>
                </group>

                <group string="Mensaje">
                    <field name="ml_option_id"/>
                    <field name="body" placeholder="Escribe tu mensaje aquí... (máximo 350 caracteres)"/>
                    <div class="row">
                        <div class="col-6">
                            <span>Caracteres: </span>
                            <field name="char_count" class="oe_inline"/>
                            <span> / 350</span>
                        </div>
                        <div class="col-6 text-end">
                            <span class="text-danger"
                                  attrs="{'invisible': [('char_over_limit', '=', False)]}">
                                Excede el límite
                            </span>
                            <span class="text-success"
                                  attrs="{'invisible': ['|', ('char_over_limit', '=', True), ('char_count', '=', 0)]}">
                                Restantes: <field name="char_remaining" class="oe_inline"/>
                            </span>
                        </div>
                    </div>
                </group>

                <group string="Programación">
                    <field name="send_now" widget="boolean_toggle"/>
                    <field name="scheduled_time"
                           attrs="{'invisible': [('send_now', '=', True)]}"/>
                </group>

                <group string="Mensajes Recientes"
                       attrs="{'invisible': [('recent_messages', '=', False)]}">
                    <field name="recent_messages" readonly="1" nolabel="1"/>
                </group>

                <field name="can_send" invisible="1"/>
                <field name="char_over_limit" invisible="1"/>

                <footer>
                    <button name="action_send" string="Enviar" type="object"
                            class="btn-primary" icon="fa-paper-plane"
                            attrs="{'invisible': ['|', ('can_send', '=', False), ('char_over_limit', '=', True)]}"/>
                    <button name="action_send" string="Enviar" type="object"
                            class="btn-secondary" disabled="1"
                            attrs="{'invisible': ['&amp;', ('can_send', '=', True), ('char_over_limit', '=', False)]}"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Message Compose Action -->
    <record id="action_mercadolibre_message_compose" model="ir.actions.act_window">
        <field name="name">Enviar Mensaje ML</field>
        <field name="res_model">mercadolibre.message.compose</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Messaging Sync Wizard Form -->
    <record id="mercadolibre_messaging_sync_view_form" model="ir.ui.view">
        <field name="name">mercadolibre.messaging.sync.form</field>
        <field name="model">mercadolibre.messaging.sync</field>
        <field name="arch" type="xml">
            <form string="Sincronizar Mensajería ML">
                <group attrs="{'invisible': [('state', '!=', 'draft')]}">
                    <group string="Cuentas">
                        <field name="all_accounts" widget="boolean_toggle"/>
                        <field name="account_id"
                               attrs="{'invisible': [('all_accounts', '=', True)],
                                       'required': [('all_accounts', '=', False)]}"/>
                    </group>
                    <group string="Opciones">
                        <field name="sync_type"/>
                        <field name="days_back"/>
                        <field name="force_resync" widget="boolean_toggle"/>
                    </group>
                </group>

                <group attrs="{'invisible': [('state', '=', 'draft')]}">
                    <group string="Progreso">
                        <field name="state" widget="statusbar"/>
                    </group>
                </group>

                <group attrs="{'invisible': [('state', 'not in', ('done', 'error'))]}"
                       string="Resultados">
                    <group>
                        <field name="conversations_synced"/>
                        <field name="messages_synced"/>
                        <field name="errors_count"/>
                    </group>
                    <group>
                        <field name="result_message" readonly="1" nolabel="1"/>
                    </group>
                </group>

                <footer>
                    <button name="action_sync" string="Sincronizar" type="object"
                            class="btn-primary" icon="fa-refresh"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_view_conversations" string="Ver Conversaciones" type="object"
                            class="btn-secondary" icon="fa-comments"
                            attrs="{'invisible': [('state', 'not in', ('done', 'error'))]}"/>
                    <button name="action_close" string="Cerrar" type="object"
                            class="btn-secondary"
                            attrs="{'invisible': [('state', '=', 'draft')]}"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"
                            attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Messaging Sync Action -->
    <record id="action_mercadolibre_messaging_sync" model="ir.actions.act_window">
        <field name="name">Sincronizar Mensajería</field>
        <field name="res_model">mercadolibre.messaging.sync</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

</odoo>
