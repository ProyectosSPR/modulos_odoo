<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_mercadolibre_api_playground_tree" model="ir.ui.view">
        <field name="name">mercadolibre.api.playground.tree</field>
        <field name="model">mercadolibre.api.playground</field>
        <field name="arch" type="xml">
            <tree string="API Playground" decoration-success="state=='success'" decoration-danger="state=='error'">
                <field name="name"/>
                <field name="account_id"/>
                <field name="api_type" widget="badge" decoration-info="api_type=='mercadolibre'" decoration-success="api_type=='mercadopago'"/>
                <field name="method"/>
                <field name="endpoint"/>
                <field name="response_code"/>
                <field name="response_size"/>
                <field name="execution_time_display" string="Tiempo"/>
                <field name="executed_at"/>
                <field name="state" widget="badge" decoration-success="state=='success'" decoration-danger="state=='error'" decoration-info="state=='draft'"/>
            </tree>
        </field>
    </record>

    <record id="view_mercadolibre_api_playground_form" model="ir.ui.view">
        <field name="name">mercadolibre.api.playground.form</field>
        <field name="model">mercadolibre.api.playground</field>
        <field name="arch" type="xml">
            <form string="API Playground">
                <header>
                    <button name="action_execute" type="object" string="Ejecutar" class="btn-primary" icon="fa-play"/>
                    <button name="action_reset" type="object" string="Limpiar" attrs="{'invisible': [('state', '=', 'draft')]}" icon="fa-refresh"/>
                    <button name="action_duplicate" type="object" string="Duplicar" icon="fa-copy"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,success,error"/>
                </header>
                <sheet>
                    <style>
                        /* URL Bar Style */
                        .ml-url-container {
                            background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .ml-url-bar {
                            display: flex;
                            gap: 10px;
                            align-items: center;
                            background: #3d3d3d;
                            border: 2px solid #4d4d4d;
                            border-radius: 8px;
                            padding: 8px 15px;
                        }
                        .ml-url-bar:focus-within {
                            border-color: #61affe;
                            box-shadow: 0 0 0 3px rgba(97, 175, 254, 0.2);
                        }
                        .ml-base-url {
                            color: #888;
                            font-family: 'Monaco', 'Menlo', monospace;
                            font-size: 13px;
                            white-space: nowrap;
                        }
                        .ml-endpoint-input {
                            flex: 1;
                            background: transparent;
                            border: none;
                            color: #fff;
                            font-family: 'Monaco', 'Menlo', monospace;
                            font-size: 13px;
                        }
                        .ml-endpoint-input:focus {
                            outline: none;
                        }

                        /* Method Badges */
                        .ml-method-badge {
                            font-weight: bold;
                            padding: 6px 14px;
                            border-radius: 6px;
                            font-size: 12px;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        }
                        .ml-method-get { background: #61affe; color: white; }
                        .ml-method-post { background: #49cc90; color: white; }
                        .ml-method-put { background: #fca130; color: white; }
                        .ml-method-delete { background: #f93e3e; color: white; }

                        /* Response Stats */
                        .ml-response-stats {
                            display: flex;
                            gap: 15px;
                            margin-bottom: 20px;
                        }
                        .ml-stat-card {
                            background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                            border-radius: 10px;
                            padding: 15px 25px;
                            text-align: center;
                            min-width: 120px;
                            border: 1px solid #3d3d3d;
                        }
                        .ml-stat-value {
                            font-size: 24px;
                            font-weight: bold;
                            font-family: 'Monaco', 'Menlo', monospace;
                        }
                        .ml-stat-label {
                            color: #888;
                            font-size: 11px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            margin-top: 5px;
                        }
                        .ml-stat-success .ml-stat-value { color: #49cc90; }
                        .ml-stat-warning .ml-stat-value { color: #fca130; }
                        .ml-stat-error .ml-stat-value { color: #f93e3e; }
                        .ml-stat-info .ml-stat-value { color: #61affe; }

                        /* Response Panel */
                        .ml-response-panel {
                            background: #1e1e1e;
                            border-radius: 12px;
                            overflow: hidden;
                            border: 1px solid #3d3d3d;
                        }
                        .ml-response-header {
                            background: linear-gradient(135deg, #2d2d2d 0%, #252525 100%);
                            padding: 12px 20px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            border-bottom: 1px solid #3d3d3d;
                        }
                        .ml-response-title {
                            color: #fff;
                            font-weight: 600;
                            font-size: 14px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        .ml-response-meta {
                            display: flex;
                            gap: 20px;
                            color: #888;
                            font-size: 12px;
                        }

                        /* Status Badges */
                        .ml-status-badge {
                            padding: 4px 12px;
                            border-radius: 20px;
                            font-weight: bold;
                            font-size: 12px;
                        }
                        .ml-status-2xx { background: rgba(73, 204, 144, 0.2); color: #49cc90; }
                        .ml-status-3xx { background: rgba(97, 175, 254, 0.2); color: #61affe; }
                        .ml-status-4xx { background: rgba(252, 161, 48, 0.2); color: #fca130; }
                        .ml-status-5xx { background: rgba(249, 62, 62, 0.2); color: #f93e3e; }

                        /* JSON Viewer */
                        .ml-json-viewer {
                            background: #1e1e1e;
                            color: #d4d4d4;
                            padding: 20px;
                            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
                            font-size: 13px;
                            line-height: 1.6;
                            max-height: 500px;
                            overflow: auto;
                            white-space: pre-wrap;
                            word-break: break-word;
                        }

                        /* Error Panel */
                        .ml-error-panel {
                            background: linear-gradient(135deg, #2d1f1f 0%, #1e1515 100%);
                            border: 1px solid #f93e3e;
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .ml-error-title {
                            color: #f93e3e;
                            font-weight: bold;
                            margin-bottom: 10px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            font-size: 14px;
                        }
                        .ml-error-message {
                            color: #ff8888;
                            font-family: 'Monaco', 'Menlo', monospace;
                            font-size: 13px;
                            background: rgba(0,0,0,0.2);
                            padding: 10px;
                            border-radius: 6px;
                        }

                        /* Request Tabs Styling */
                        .ml-request-section {
                            background: #f8f9fa;
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .ml-section-title {
                            color: #2D3277;
                            font-weight: 600;
                            font-size: 14px;
                            margin-bottom: 15px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                        }

                        /* Full URL Display */
                        .ml-full-url {
                            background: #2d2d2d;
                            color: #61affe;
                            padding: 10px 15px;
                            border-radius: 6px;
                            font-family: 'Monaco', 'Menlo', monospace;
                            font-size: 12px;
                            margin-top: 10px;
                            word-break: break-all;
                        }
                    </style>

                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nombre del request"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="account_id" options="{'no_create': True}"/>
                            <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                        </group>
                        <group>
                            <field name="executed_at" readonly="1"/>
                        </group>
                    </group>

                    <separator string="Request"/>
                    <group>
                        <group>
                            <field name="api_type" widget="radio" options="{'horizontal': true}"/>
                            <field name="method" widget="radio" options="{'horizontal': true}"/>
                        </group>
                        <group>
                            <label for="endpoint"/>
                            <div class="d-flex align-items-center">
                                <span class="text-muted mr-1" attrs="{'invisible': [('api_type', '=', 'mercadopago')]}">https://api.mercadolibre.com</span>
                                <span class="text-muted mr-1" attrs="{'invisible': [('api_type', '!=', 'mercadopago')]}">https://api.mercadopago.com</span>
                                <field name="endpoint" placeholder="/users/me o /v1/payments/search" class="flex-grow-1"/>
                            </div>
                        </group>
                    </group>

                    <div attrs="{'invisible': [('full_url', '=', False)]}">
                        <span class="o_form_label">URL Completa</span>
                        <div class="ml-full-url">
                            <field name="full_url" nolabel="1" readonly="1"/>
                        </div>
                    </div>

                    <notebook>
                        <page string="Params" name="params">
                            <field name="request_params" placeholder='{"q": "iphone", "limit": 10}' widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Body" name="body" attrs="{'invisible': [('method', 'not in', ['POST', 'PUT'])]}">
                            <field name="request_body" placeholder='{"title": "Mi producto", "price": 100}' widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Headers" name="headers">
                            <field name="custom_headers" placeholder='{"X-Custom-Header": "value"}' widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Notas" name="notes">
                            <field name="notes" placeholder="Notas sobre este request..."/>
                        </page>
                    </notebook>

                    <div attrs="{'invisible': [('state', '=', 'draft')]}">
                        <separator string="Response"/>

                        <div class="ml-response-stats">
                            <div class="ml-stat-card ml-stat-success" attrs="{'invisible': [('response_code', '&lt;', 200), ('response_code', '&gt;=', 300)]}">
                                <div class="ml-stat-value"><field name="response_code" nolabel="1" readonly="1"/></div>
                                <div class="ml-stat-label">Status Code</div>
                            </div>
                            <div class="ml-stat-card ml-stat-warning" attrs="{'invisible': ['|', ('response_code', '&lt;', 400), ('response_code', '&gt;=', 500)]}">
                                <div class="ml-stat-value"><field name="response_code" nolabel="1" readonly="1"/></div>
                                <div class="ml-stat-label">Status Code</div>
                            </div>
                            <div class="ml-stat-card ml-stat-error" attrs="{'invisible': [('response_code', '&lt;', 500)]}">
                                <div class="ml-stat-value"><field name="response_code" nolabel="1" readonly="1"/></div>
                                <div class="ml-stat-label">Status Code</div>
                            </div>
                            <div class="ml-stat-card ml-stat-info">
                                <div class="ml-stat-value"><field name="execution_time_display" nolabel="1" readonly="1"/></div>
                                <div class="ml-stat-label">Tiempo</div>
                            </div>
                            <div class="ml-stat-card ml-stat-info">
                                <div class="ml-stat-value"><field name="response_size" nolabel="1" readonly="1"/></div>
                                <div class="ml-stat-label">Tamano</div>
                            </div>
                        </div>

                        <div class="ml-error-panel" attrs="{'invisible': [('error_message', '=', False)]}">
                            <div class="ml-error-title">
                                <i class="fa fa-exclamation-triangle"/>
                                Error en la solicitud
                            </div>
                            <div class="ml-error-message">
                                <field name="error_message" nolabel="1" readonly="1"/>
                            </div>
                        </div>

                        <notebook attrs="{'invisible': ['|', ('state', '=', 'draft'), ('response_body', '=', False)]}">
                            <page string="Body" name="response_body">
                                <field name="response_body" readonly="1" widget="ace" options="{'mode': 'json'}"/>
                            </page>
                            <page string="Headers" name="response_headers">
                                <field name="response_headers" readonly="1" widget="ace" options="{'mode': 'json'}"/>
                            </page>
                            <page string="Raw" name="response_raw">
                                <field name="response_body_raw" readonly="1" widget="ace" options="{'mode': 'json'}"/>
                            </page>
                        </notebook>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_mercadolibre_api_playground_search" model="ir.ui.view">
        <field name="name">mercadolibre.api.playground.search</field>
        <field name="model">mercadolibre.api.playground</field>
        <field name="arch" type="xml">
            <search string="API Playground">
                <field name="name"/>
                <field name="account_id"/>
                <field name="endpoint"/>
                <filter string="Borradores" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Exitosos" name="success" domain="[('state', '=', 'success')]"/>
                <filter string="Con Errores" name="error" domain="[('state', '=', 'error')]"/>
                <separator/>
                <filter string="GET" name="get" domain="[('method', '=', 'GET')]"/>
                <filter string="POST" name="post" domain="[('method', '=', 'POST')]"/>
                <filter string="PUT" name="put" domain="[('method', '=', 'PUT')]"/>
                <filter string="DELETE" name="delete" domain="[('method', '=', 'DELETE')]"/>
                <group expand="0" string="Agrupar por">
                    <filter string="Cuenta" name="account" context="{'group_by': 'account_id'}"/>
                    <filter string="Metodo" name="method" context="{'group_by': 'method'}"/>
                    <filter string="Estado" name="state" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_mercadolibre_api_playground" model="ir.actions.act_window">
        <field name="name">API Playground</field>
        <field name="res_model">mercadolibre.api.playground</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear un nuevo request API
            </p>
            <p>
                Prueba endpoints de la API de MercadoLibre con tus cuentas conectadas.
                <br/>
                <b>Ejemplos de endpoints:</b>
            </p>
            <ul>
                <li><code>/users/me</code> - Informacion del usuario</li>
                <li><code>/sites/MLM/search?q=iphone</code> - Buscar productos</li>
                <li><code>/items/{ITEM_ID}</code> - Detalle de producto</li>
                <li><code>/orders/search?seller={USER_ID}</code> - Ordenes del vendedor</li>
            </ul>
        </field>
    </record>
</odoo>
