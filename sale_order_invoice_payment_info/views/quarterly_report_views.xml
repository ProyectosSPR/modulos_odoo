<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista Tree del Reporte Cuatrimestral -->
    <record id="view_quarterly_sales_report_tree" model="ir.ui.view">
        <field name="name">quarterly.sales.report.tree</field>
        <field name="model">quarterly.sales.report</field>
        <field name="arch" type="xml">
            <tree string="Reporte de Ventas por Cuatrimestre" create="false" delete="true" edit="false">
                <field name="year"/>
                <field name="quarter"/>
                <field name="period_month"/>
                <field name="team_unified_id"/>
                <field name="quarter_goal" sum="total_goal" widget="monetary"/>
                <field name="projected_amount" sum="total_projected" widget="monetary"/>
                <field name="actual_sales" sum="total_sales" widget="monetary"/>
                <field name="difference" sum="total_difference" widget="monetary"
                       decoration-success="difference &gt;= 0"
                       decoration-danger="difference &lt; 0"/>
                <field name="goal_percentage" widget="percentage"
                       decoration-success="goal_percentage &gt;= 100"
                       decoration-warning="goal_percentage &gt;= 80 and goal_percentage &lt; 100"
                       decoration-danger="goal_percentage &lt; 80"/>
                <field name="projected_percentage" widget="percentage"
                       decoration-success="projected_percentage &gt;= 100"
                       decoration-warning="projected_percentage &gt;= 80 and projected_percentage &lt; 100"
                       decoration-danger="projected_percentage &lt; 80"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Vista Pivot del Reporte Cuatrimestral -->
    <record id="view_quarterly_sales_report_pivot" model="ir.ui.view">
        <field name="name">quarterly.sales.report.pivot</field>
        <field name="model">quarterly.sales.report</field>
        <field name="arch" type="xml">
            <pivot string="Análisis por Cuatrimestre" display_quantity="true">
                <field name="quarter" type="row"/>
                <field name="team_unified_id" type="row"/>
                <field name="period_month" type="col"/>
                <field name="quarter_goal" type="measure"/>
                <field name="projected_amount" type="measure"/>
                <field name="actual_sales" type="measure"/>
                <field name="difference" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Vista Graph del Reporte Cuatrimestral -->
    <record id="view_quarterly_sales_report_graph" model="ir.ui.view">
        <field name="name">quarterly.sales.report.graph</field>
        <field name="model">quarterly.sales.report</field>
        <field name="arch" type="xml">
            <graph string="Ventas por Cuatrimestre" type="bar" stacked="False">
                <field name="period_month"/>
                <field name="projected_amount" type="measure"/>
                <field name="actual_sales" type="measure"/>
                <field name="team_unified_id"/>
            </graph>
        </field>
    </record>

    <!-- Vista de Búsqueda -->
    <record id="view_quarterly_sales_report_search" model="ir.ui.view">
        <field name="name">quarterly.sales.report.search</field>
        <field name="model">quarterly.sales.report</field>
        <field name="arch" type="xml">
            <search string="Buscar Reporte">
                <field name="year"/>
                <field name="quarter"/>
                <field name="period_month"/>
                <field name="team_unified_id"/>
                <field name="projection_id"/>
                <filter string="Q1 (Ene-Abr)" name="q1" domain="[('quarter', '=', 'Q1')]"/>
                <filter string="Q2 (May-Ago)" name="q2" domain="[('quarter', '=', 'Q2')]"/>
                <filter string="Q3 (Sep-Dic)" name="q3" domain="[('quarter', '=', 'Q3')]"/>
                <separator/>
                <filter string="Año Actual" name="current_year"
                        domain="[('year', '=', context_today().year)]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Cuatrimestre" name="group_quarter" context="{'group_by': 'quarter'}"/>
                    <filter string="Mes" name="group_month" context="{'group_by': 'period_month'}"/>
                    <filter string="Equipo" name="group_team" context="{'group_by': 'team_unified_id'}"/>
                    <filter string="Año" name="group_year" context="{'group_by': 'year'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Vista Form detallada (solo lectura) -->
    <record id="view_quarterly_sales_report_form" model="ir.ui.view">
        <field name="name">quarterly.sales.report.form</field>
        <field name="model">quarterly.sales.report</field>
        <field name="arch" type="xml">
            <form string="Detalle del Reporte" create="false" delete="true" edit="false">
                <sheet>
                    <group>
                        <group>
                            <field name="year"/>
                            <field name="quarter"/>
                            <field name="period_month"/>
                            <field name="team_unified_id"/>
                            <field name="projection_id"/>
                        </group>
                        <group>
                            <field name="quarter_goal" widget="monetary"/>
                            <field name="projected_amount" widget="monetary"/>
                            <field name="actual_sales" widget="monetary"/>
                            <field name="difference" widget="monetary"/>
                            <field name="goal_percentage" widget="percentage"/>
                            <field name="projected_percentage" widget="percentage"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>
                    <group string="Análisis">
                        <div class="alert alert-info" role="alert"
                             attrs="{'invisible': [('difference', '&lt;', 0)]}">
                            <strong>Objetivo alcanzado:</strong> Las ventas superaron el estimado por
                            <field name="difference" widget="monetary" class="oe_inline"/>.
                        </div>
                        <div class="alert alert-warning" role="alert"
                             attrs="{'invisible': [('difference', '&gt;=', 0)]}">
                            <strong>Por debajo del estimado:</strong> Las ventas están por debajo del estimado por
                            <field name="difference" widget="monetary" class="oe_inline"/>.
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Acción para Reporte Cuatrimestral -->
    <record id="action_quarterly_sales_report" model="ir.actions.act_window">
        <field name="name">Reporte por Cuatrimestre</field>
        <field name="res_model">quarterly.sales.report</field>
        <field name="view_mode">tree,pivot,graph,form</field>
        <field name="context">{'group_by': ['quarter', 'period_month']}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No hay datos de reporte disponibles
            </p>
            <p>
                El reporte se genera automáticamente cuando:
                <ul>
                    <li>Tienes una proyección activa</li>
                    <li>Has configurado metas para los equipos</li>
                    <li>Existen ventas registradas en el periodo</li>
                </ul>
            </p>
        </field>
    </record>

</odoo>
