<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Form View -->
    <record id="view_mercadolibre_product_link_form" model="ir.ui.view">
        <field name="name">mercadolibre.product.link.form</field>
        <field name="model">mercadolibre.product.link</field>
        <field name="arch" type="xml">
            <form string="Vincular Producto">
                <group>
                    <field name="link_mode" widget="radio"/>
                </group>

                <!-- Modo: Item a Producto -->
                <group attrs="{'invisible': [('link_mode', '!=', 'item_to_product')]}">
                    <group string="Item MercadoLibre">
                        <field name="item_id" domain="[('account_id', '=', account_id)]"/>
                        <field name="variation_id" domain="[('item_id', '=', item_id)]"
                               attrs="{'invisible': [('item_id', '=', False)]}"/>
                        <field name="account_id" invisible="1"/>
                    </group>
                    <group string="Producto Odoo">
                        <field name="product_tmpl_id"/>
                        <field name="product_id" domain="[('product_tmpl_id', '=', product_tmpl_id)]"
                               attrs="{'invisible': [('product_tmpl_id', '=', False)]}"/>
                    </group>
                </group>

                <!-- Modo: Producto a Item -->
                <group attrs="{'invisible': [('link_mode', '!=', 'product_to_item')]}">
                    <group string="Producto Odoo">
                        <field name="product_tmpl_id"/>
                        <field name="product_id" domain="[('product_tmpl_id', '=', product_tmpl_id)]"/>
                    </group>
                    <group string="Buscar Item ML">
                        <field name="account_id"/>
                        <field name="search_ml_item_id" placeholder="Ej: MLM1234567890"/>
                        <button name="action_search_item" type="object"
                                string="Buscar" icon="fa-search"
                                class="btn-secondary"
                                attrs="{'invisible': ['|', ('account_id', '=', False), ('search_ml_item_id', '=', False)]}"/>
                    </group>
                </group>

                <!-- Item seleccionado -->
                <group attrs="{'invisible': [('selected_item_id', '=', False)]}">
                    <group string="Item Encontrado">
                        <field name="selected_item_id" readonly="1"/>
                        <field name="selected_variation_id"
                               domain="[('item_id', '=', selected_item_id)]"
                               attrs="{'invisible': [('selected_item_id', '=', False)]}"/>
                    </group>
                </group>

                <!-- Informacion -->
                <group>
                    <group string="Info Item ML" attrs="{'invisible': [('item_info', '=', '')]}">
                        <field name="item_info" nolabel="1" readonly="1"
                               style="font-family: monospace; background: #f5f5f5; padding: 10px; white-space: pre;"/>
                    </group>
                    <group string="Info Producto Odoo" attrs="{'invisible': [('product_info', '=', '')]}">
                        <field name="product_info" nolabel="1" readonly="1"
                               style="font-family: monospace; background: #f5f5f5; padding: 10px; white-space: pre;"/>
                    </group>
                </group>

                <footer>
                    <button name="action_link" type="object"
                            string="Vincular" class="btn-primary"
                            attrs="{'invisible': ['|', '|',
                                    '&amp;', ('item_id', '=', False), ('selected_item_id', '=', False),
                                    '&amp;', ('product_tmpl_id', '=', False), ('product_id', '=', False),
                                    ('link_mode', '=', False)]}"/>
                    <button name="action_unlink" type="object"
                            string="Desvincular" class="btn-warning"
                            attrs="{'invisible': ['&amp;', ('item_id', '=', False), ('selected_item_id', '=', False)]}"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_mercadolibre_product_link" model="ir.actions.act_window">
        <field name="name">Vincular Producto</field>
        <field name="res_model">mercadolibre.product.link</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>
